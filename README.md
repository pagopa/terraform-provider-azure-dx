# terraform-provider-azure-dx

The azure-dx Terraform provider is for Developer Experience, simplifies the creation and management of Azure resources following standardized naming conventions. This provider is maintained by the [PagoPA organization](https://github.com/pagopa) and is available at [terraform-provider-azure-dx](https://github.com/pagopa/terraform-provider-azure-dx).

## Installation

To configure the provider, execute the following commands in the main directory of the repository:

```bash
go mod init github.com/pagopa/terraform-provider-azure-dx
go mod tidy
go build -o terraform-provider-azure-dx
```

To configure the docs follow this documentation for [docs format](https://developer.hashicorp.com/terraform/registry/providers/docs) and [go generate](https://developer.hashicorp.com/terraform/tutorials/providers-plugin-framework/providers-plugin-framework-documentation-generation)

```bash
cd tools
go mod init tools
go mod tidy
go generate
```

> [!NOTE]  
> If `go generate` return error for DataSource/Resource name, rename temporarly metadata to match name and re execute command

## Usage

### Required Provider Configuration

To use the azure-dx provider in your Terraform configuration, include the following block:

```hcl
terraform {
  required_providers {
    dx = {
      source = "pagopa/azure-dx"
    }
  }
}

provider "dx" {
  prefix      = "<project_prefix>" # e.g., "dx", "io"
  environment = "<environment>"    # d, u, or p (dev, uat, or prod)
  location    = "<location>"       # itn (Italy North) or weu (West Europe)
}
```

**Inputs:**

|Name|Type|Required|Description|
|:---|:---:|:---:|:---|
|prefix|String|Yes|Two-character project prefix.|
|environment|String|Yes|Deployment environment (d, u, or p).|
|location|String|Yes|Deployment location (itn or weu).|
|domain|String|No|Optional domain for naming.|

## Data Sources

### dx_prefix_value

Generates a standardized prefix for resource naming based on the configured inputs.

**Example:**

```hcl
data "dx_prefix_value" "base" {}
```

- **Output**: A prefix in the format:
  - **With domain**: [prefix]-[environment]-[location]-[domain]
  - **Without domain**: [prefix]-[environment]-[location]

## Functions

### resource_name

Generates a resource name based on the standardized prefix and additional parameters.

**Inputs:**

|Name|Type|Required|Description|
|:---|:---:|:---:|:---|
|prefix|String|Yes|Prefix generated by dx_prefix_value.|
|resource|String|Yes|Name of the resource.|
|type|String|Yes|Type of the resource (see table).|
|instance|Integer|Yes|Instance number of the resource.|

**Example:**

```hcl
output "resource_name" {
  value = provider::dx::resource_name(data.dx_prefix_value.base.value, "app", "blob_private_endpoint", 1)
}
```

- **Output**: dx-d-itn-app-blob-pep-01

> [!NOTE]  
> Remember that to call a function is needed the path provider::PROVIDER_NAME::FUNCTION_NAME(...)

**Resource Types:**

The following table lists the resource types and their abbreviations used in the resource_name function:

|Type|Abbreviation|
|:---|:---:|
|virtual_machine|vm|
|container_app_job|caj|
|storage_account|st|
|blob_storage|blob|
|queue_storage|queue|
|table_storage|table|
|file_storage|file|
|function_storage_account|stfn|
|api_management|apim|
|api_management_autoscale|apim-as|
|virtual_network|vnet|
|network_security_group|nsg|
|apim_network_security_group|apim-nsg|
|app_gateway|agw|
|cosmos_private_endpoint|cosno-pep|
|postgre_private_endpoint|psql-pep|
|blob_private_endpoint|blob-pep|
|queue_private_endpoint|queue-pep|
|file_private_endpoint|file-pep|
|table_private_endpoint|table-pep|
|eventhub_private_endpoint|evhns-pep|
|app_subnet|app-snet|
|apim_subnet|apim-snet|
|function_subnet|func-snet|
|cosmos_db|cosmos|
|cosmos_db_nosql|cosno|
|postgresql|psql|
|postgresq_replica|psql-replica|
|eventhub_namespace|evhns|
|function_app|func|
|app_service|app|
|app_service_plan|asp|
|key_vault|kv|
|application_insights|appi|
|resource_group|rg|

## Example Configuration

```hcl
terraform {
  required_providers {
    dx = {
      source  = "pagopa/azure-dx"
    }
  }
}

provider "dx" {
  prefix      = "dx"
  environment = "d"
  location    = "itn"
}

data "dx_prefix_value" "base" {}

output "resource_name" {
  value = provider::dx::resource_name(data.dx_prefix_value.base.value, "app", "blob_private_endpoint", 1)
}
````

**Result**: dx-d-itn-app-blob-pep-01
